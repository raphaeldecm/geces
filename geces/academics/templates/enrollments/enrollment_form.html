{% extends "base.html" %}

{% load i18n %}
{% load bootstrap5 %}
{% load save_cancel_buttons %}
{% load breadcrumb_item %}

{% block page_name %}
  {{ title }}
{% endblock page_name %}
{% block breadcrumb_items %}
  {{ block.super }}
  {% breadcrumb_item text="Página Inicial" url="home" %}
  {% breadcrumb_item text="Acadêmico" url="academics:academics_home" %}
  {% breadcrumb_item text="Lista de Matrículas" url="academics:enrollment_list" %}
  {% breadcrumb_item text=title active="active" %}
{% endblock breadcrumb_items %}
{% block content %}
  {% block alerts %}
    {% include "layouts/alerts.html" %}
  {% endblock alerts %}
  <div class="card card-primary mx-3">
    <div class="card-header">
      <h3 class="card-title">Matrícula</h3>
    </div>
    <div class="card-body p-0 mt-3">
      <form method="post" autocomplete="off">
        {% csrf_token %}
        <div class="row mx-auto mb-3">
          <div class="col-12 col-sm-6">{% bootstrap_field form.reference_year %}</div>
          <div class="col-12 col-sm-6">{% bootstrap_field form.student_group %}</div>
        </div>
        <div class="row mx-auto mb-3">
          <div class="col-12 col-sm-6">{% bootstrap_field form.student %}</div>
          <div class="col-12 col-sm-6">{% bootstrap_field form.status %}</div>
        </div>
        {% url "academics:enrollment_list" as enrollment_list %}
        {% save_cancel_buttons link_back=enrollment_list has_form=True %}
      </form>
    </div>
  </div>
{% endblock content %}
{% block extra_js %}
  {{ form.media }}
  <script>
    $(document).ready(function() {
      $('#id_reference_year').on('change', function() {
        var reference_year = $(this).val();

        $.ajax({
          url: "{% url 'academics:get_student_group_by_year' %}",
          method: 'GET',
          data: {
            'reference_year': reference_year
          },
          dataType: 'json',
          success: function(data) {
            var studentGroupSelect = $('#id_student_group');
            studentGroupSelect.empty();
            console.log(data.student_groups);

            if (data.student_groups) {
              $.each(data.student_groups, function(index, group) {
                studentGroupSelect.append($('<option>', {
                  value: group.id,
                  text: group.serie__name + ' - ' + group.serie__shift__name
                }));
              });
              studentGroupSelect.prop('disabled', false); // Habilita o campo de seleção da turma
            } else {
              studentGroupSelect.prop('disabled', true); // Desativa o campo de seleção da turma se não houver séries
            }
          },
          error: function(err) {
            console.log('Erro ao buscar as séries:', err);
          }
        });
      });
    });
  </script>
{% endblock extra_js %}
